#!/bin/bash


function usage() {
    echo "Usage: "$0" <domain_file>"
    if [ -n "$1" ] ; then
		echo "Error: "$1"!"
    fi
    exit
}

if [ ! $# -eq 1 ] ; then
    usage
fi

file=$1

if [ ! -f $file ] ; then
    usage "file not found"
fi

n=0
i=0
total=$(cat $file | wc -l | tr -d [:space:])
domains=$(cat $file)
echo "Trying $total zone transfer..."
echo

for d in $domains ; do
    i=$[$i+1]
	echo -ne " [$i/$total] "$d"\r"

    host=$(host -t NS $d)
    has_ns=$(echo $host | grep " name server ")

    if [ -n "$has_ns" ] ; then
        ns=$(echo $host | awk '{print $NF}' | sed "s/\.$//")

        for nnss in $(echo $ns) ; do
            axfr=`host -4 -W 1 -t axfr $d $nnss | grep ";; ANSWER SECTION:"`
            if [ -n "$axfr" ] ; then
                printf "\033[0;32m [$i/$total] $d successful\033[0m"
                echo
                n=$[$n+1]
            fi
            # axfr=`host -4 -W 1 -t axfr $d $nnss`
            # failed=`echo "$axfr" | grep 'Transfer failed'`
            # timeout=`echo "$axfr" | grep 'timed out'`
            # error=`echo "$axfr" | grep 'communications error'`

            # if [ ! -n "$timeout" ] ; then
            #     if [ ! -n "$error" ] ; then
            #         if [ ! -n "$failed" ] ; then
            #             _print "$d successful!" GREEN
            #             echo
            #             n=$[$n+1]
            #         fi
            #     fi
            # fi
        done
    fi

	echo -ne "                                                                                                                                          \r"
done

echo
echo $n" zone transfer successful."
echo

exit
